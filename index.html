<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Bivariate World Map</title>
<script src="https://d3js.org/d3.v7.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/topojson@3"></script>
<style>
  body {
    font-family: sans-serif;
  }
  svg {
    width: 100%;
    height: 600px;
  }
  .country {
    stroke: #fff;
    stroke-width: 0.5px;
  }
  .legend {
    display: grid;
    grid-template-columns: repeat(3, 30px);
    gap: 2px;
    margin-top: 10px;
  }
  .legend div {
    width: 30px;
    height: 30px;
  }
  .legend-label {
    margin-top: 5px;
    font-size: 12px;
  }
</style>
</head>
<body>
<h2>Bivariate World Map with Dummy Data</h2>
<svg></svg>

<div>
  <div>Bivariate Legend:</div>
  <div class="legend" id="legend"></div>
  <div class="legend-label">Var1 →</div>
  <div class="legend-label">Var2 ↓</div>
</div>

<script>
const width = 960;
const height = 600;

const svg = d3.select("svg")
  .attr("width", width)
  .attr("height", height);

const projection = d3.geoMercator()
  .scale(150)
  .translate([width/2, height/1.5]);

const path = d3.geoPath().projection(projection);

// Create dummy data for every country (var1 and var2 between 0 and 1)
function generateData() {
  const data = {};
  // ISO numeric codes roughly from 4 to 894 (simplified)
  for (let i = 4; i <= 894; i++) {
    const code = i.toString();
    data[code] = [Math.random(), Math.random()];
  }
  return data;
}

const data = generateData();

// 3x3 bivariate color scale
const colorScale = d3.scaleOrdinal()
  .domain([
    "0-0","0-1","0-2",
    "1-0","1-1","1-2",
    "2-0","2-1","2-2"
  ])
  .range([
    "#e8e8e8","#ace4e4","#5ac8c8",
    "#dfb0d6","#a5add3","#5698b9",
    "#be64ac","#8c62aa","#3b4994"
  ]);

// Map var1 and var2 into 0,1,2 bins
function getBivariateKey(var1, var2) {
  const bin1 = Math.floor(var1 * 3);
  const bin2 = Math.floor(var2 * 3);
  return `${Math.min(bin1,2)}-${Math.min(bin2,2)}`;
}

// Load world TopoJSON
d3.json("https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json").then(worldData => {
  const countries = topojson.feature(worldData, worldData.objects.countries).features;

  svg.selectAll("path")
    .data(countries)
    .enter()
    .append("path")
    .attr("class", "country")
    .attr("d", path)
    .attr("fill", d => {
      const countryData = data[d.id];
      if (!countryData) return "#eee";
      const [var1, var2] = countryData;
      return colorScale(getBivariateKey(var1, var2));
    });

  // Add legend
  const legendContainer = d3.select("#legend");
  const legendKeys = colorScale.domain();
  legendContainer.selectAll("div")
    .data(legendKeys)
    .enter()
    .append("div")
    .style("background-color", d => colorScale(d));
});

</script>
</body>
</html>
