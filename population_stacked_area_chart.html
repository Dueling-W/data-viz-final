<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Stacked Area Chart - Population by Continent</title>
<script src="https://d3js.org/d3.v7.min.js"></script>
<style>
  body { font-family: sans-serif; }
  svg { width: 100%; height: 600px; }
  .tooltip {
    position: absolute;
    background-color: white;
    border: 1px solid #999;
    padding: 5px;
    opacity: 0;
    pointer-events: none;
  }
</style>
</head>
<body>
<svg></svg>
<div class="tooltip"></div>
<script>
// Example country â†’ continent mapping
const countryContinent = {
  "Afghanistan":"Asia",
"Albania":"Europe",
"Algeria":"Africa",
"American Samoa":"Oceania",
"Andorra":"Europe",
"Angola":"Africa",
"Anguilla":"North America",
"Antarctica":"Antarctica",
"Antigua and Barbuda":"North America",
"Argentina":"South America",
"Armenia":"Asia",
"Aruba":"North America",
"Australia":"Oceania",
"Austria":"Europe",
"Azerbaijan":"Asia",
"Bahamas":"North America",
"Bahrain":"Asia",
"Bangladesh":"Asia",
"Barbados":"North America",
"Belarus":"Europe",
"Belgium":"Europe",
"Belize":"North America",
"Benin":"Africa",
"Bermuda":"North America",
"Bhutan":"Asia",
"Bolivia":"South America",
"Bosnia and Herzegovina":"Europe",
"Botswana":"Africa",
"Bouvet Island":"Antarctica",
"Brazil":"South America",
"British Indian Ocean Territory":"Africa",
"Brunei":"Asia",
"Bulgaria":"Europe",
"Burkina Faso":"Africa",
"Burundi":"Africa",
"Cambodia":"Asia",
"Cameroon":"Africa",
"Canada":"North America",
"Cape Verde":"Africa",
"Cayman Islands":"North America",
"Central African Republic":"Africa",
"Chad":"Africa",
"Chile":"South America",
"China":"Asia",
"Christmas Island":"Oceania",
"Cocos (Keeling) Islands":"Oceania",
"Colombia":"South America",
"Comoros":"Africa",
"Congo":"Africa",
"Cook Islands":"Oceania",
"Costa Rica":"North America",
"Croatia":"Europe",
"Cuba":"North America",
"Cyprus":"Asia",
"Czech Republic":"Europe",
"Denmark":"Europe",
"Djibouti":"Africa",
"Dominica":"North America",
"Dominican Republic":"North America",
"East Timor":"Asia",
"Ecuador":"South America",
"Egypt":"Africa",
"El Salvador":"North America",
"England":"Europe",
"Equatorial Guinea":"Africa",
"Eritrea":"Africa",
"Estonia":"Europe",
"Ethiopia":"Africa",
"Falkland Islands":"South America",
"Faroe Islands":"Europe",
"Fiji Islands":"Oceania",
"Finland":"Europe",
"France":"Europe",
"French Guiana":"South America",
"French Polynesia":"Oceania",
"French Southern territories":"Antarctica",
"Gabon":"Africa",
"Gambia":"Africa",
"Georgia":"Asia",
"Germany":"Europe",
"Ghana":"Africa",
"Gibraltar":"Europe",
"Greece":"Europe",
"Greenland":"North America",
"Grenada":"North America",
"Guadeloupe":"North America",
"Guam":"Oceania",
"Guatemala":"North America",
"Guinea":"Africa",
"Guinea-Bissau":"Africa",
"Guyana":"South America",
"Haiti":"North America",
"Heard Island and McDonald Islands":"Antarctica",
"Holy See (Vatican City State)":"Europe",
"Honduras":"North America",
"Hong Kong":"Asia",
"Hungary":"Europe",
"Iceland":"Europe",
"India":"Asia",
"Indonesia":"Asia",
"Iran":"Asia",
"Iraq":"Asia",
"Ireland":"Europe",
"Israel":"Asia",
"Italy":"Europe",
"Ivory Coast":"Africa",
"Jamaica":"North America",
"Japan":"Asia",
"Jordan":"Asia",
"Kazakhstan":"Asia",
"Kenya":"Africa",
"Kiribati":"Oceania",
"Kuwait":"Asia",
"Kyrgyzstan":"Asia",
"Laos":"Asia",
"Latvia":"Europe",
"Lebanon":"Asia",
"Lesotho":"Africa",
"Liberia":"Africa",
"Libyan Arab Jamahiriya":"Africa",
"Liechtenstein":"Europe",
"Lithuania":"Europe",
"Luxembourg":"Europe",
"Macao":"Asia",
"North Macedonia":"Europe",
"Madagascar":"Africa",
"Malawi":"Africa",
"Malaysia":"Asia",
"Maldives":"Asia",
"Mali":"Africa",
"Malta":"Europe",
"Marshall Islands":"Oceania",
"Martinique":"North America",
"Mauritania":"Africa",
"Mauritius":"Africa",
"Mayotte":"Africa",
"Mexico":"North America",
"Micronesia, Federated States of":"Oceania",
"Moldova":"Europe",
"Monaco":"Europe",
"Mongolia":"Asia",
"Montenegro":"Europe",
"Montserrat":"North America",
"Morocco":"Africa",
"Mozambique":"Africa",
"Myanmar":"Asia",
"Namibia":"Africa",
"Nauru":"Oceania",
"Nepal":"Asia",
"Netherlands":"Europe",
"Netherlands Antilles":"North America",
"New Caledonia":"Oceania",
"New Zealand":"Oceania",
"Nicaragua":"North America",
"Niger":"Africa",
"Nigeria":"Africa",
"Niue":"Oceania",
"Norfolk Island":"Oceania",
"North Korea":"Asia",
"Northern Ireland":"Europe",
"Northern Mariana Islands":"Oceania",
"Norway":"Europe",
"Oman":"Asia",
"Pakistan":"Asia",
"Palau":"Oceania",
"Palestine":"Asia",
"Panama":"North America",
"Papua New Guinea":"Oceania",
"Paraguay":"South America",
"Peru":"South America",
"Philippines":"Asia",
"Pitcairn":"Oceania",
"Poland":"Europe",
"Portugal":"Europe",
"Puerto Rico":"North America",
"Qatar":"Asia",
"Reunion":"Africa",
"Romania":"Europe",
"Russian Federation":"Europe",
"Rwanda":"Africa",
"Saint Helena":"Africa",
"Saint Kitts and Nevis":"North America",
"Saint Lucia":"North America",
"Saint Pierre and Miquelon":"North America",
"Saint Vincent and the Grenadines":"North America",
"Samoa":"Oceania",
"San Marino":"Europe",
"Sao Tome and Principe":"Africa",
"Saudi Arabia":"Asia",
"Scotland":"Europe",
"Senegal":"Africa",
"Serbia":"Europe",
"Seychelles":"Africa",
"Sierra Leone":"Africa",
"Singapore":"Asia",
"Slovakia":"Europe",
"Slovenia":"Europe",
"Solomon Islands":"Oceania",
"Somalia":"Africa",
"South Africa":"Africa",
"South Georgia and the South Sandwich Islands":"Antarctica",
"South Korea":"Asia",
"South Sudan":"Africa",
"Spain":"Europe",
"Sri Lanka":"Asia",
"Sudan":"Africa",
"Suriname":"South America",
"Svalbard and Jan Mayen":"Europe",
"Swaziland":"Africa",
"Sweden":"Europe",
"Switzerland":"Europe",
"Syria":"Asia",
"Tajikistan":"Asia",
"Tanzania":"Africa",
"Thailand":"Asia",
"The Democratic Republic of Congo":"Africa",
"Togo":"Africa",
"Tokelau":"Oceania",
"Tonga":"Oceania",
"Trinidad and Tobago":"North America",
"Tunisia":"Africa",
"Turkey":"Asia",
"Turkmenistan":"Asia",
"Turks and Caicos Islands":"North America",
"Tuvalu":"Oceania",
"Uganda":"Africa",
"Ukraine":"Europe",
"United Arab Emirates":"Asia",
"United Kingdom":"Europe",
"United States":"North America",
"United States Minor Outlying Islands":"Oceania",
"Uruguay":"South America",
"Uzbekistan":"Asia",
"Vanuatu":"Oceania",
"Venezuela":"South America",
"Vietnam":"Asia",
"Virgin Islands, British":"North America",
"Virgin Islands, U.S.":"North America",
"Wales":"Europe",
"Wallis and Futuna":"Oceania",
"Western Sahara":"Africa",
"Yemen":"Asia",
"Zambia":"Africa",
"Zimbabwe":"Africa"
};

const svg = d3.select("svg"),
      margin = {top: 50, right: 150, bottom: 50, left: 80},
      width = +svg.attr("width") || 960 - margin.left - margin.right,
      height = +svg.attr("height") || 600 - margin.top - margin.bottom;

const g = svg.append("g").attr("transform", `translate(${margin.left},${margin.top})`);
const tooltip = d3.select(".tooltip");

const xAxisG = g.append("g").attr("class", "x-axis").attr("transform", `translate(0,${height})`);
const yAxisG = g.append("g").attr("class", "y-axis");

d3.csv("population_data.csv").then(data => {
  const years = data.columns.slice(4).map(d => +d);

  // Sum population by continent
  const continents = Array.from(new Set(Object.values(countryContinent)));
  const continentData = continents.map(continent => {
    const obj = {continent};
    years.forEach(y => {
      obj[y] = data
        .filter(d => countryContinent[d["Country Name"]] === continent)
        .reduce((sum, d) => sum + (+d[y]), 0);
    });
    return obj;
  });

  // Prepare stack data
  const stack = d3.stack()
                  .keys(continents)
                  .value((d, key) => d[key]);

  const stackedData = stack(years.map(y => {
    const obj = {Year: y};
    continents.forEach(c => {
      const cData = continentData.find(d => d.continent === c);
      obj[c] = cData[y];
    });
    return obj;
  }));

  const x = d3.scaleLinear().domain(d3.extent(years)).range([0, width]);
  const y = d3.scaleLinear().domain([0, d3.max(stackedData, s => d3.max(s, d => d[1]))]).range([height, 0]);
  const color = d3.scaleOrdinal(d3.schemeCategory10).domain(continents);

  const area = d3.area()
                 .x(d => x(d.data.Year))
                 .y0(d => y(d[0]))
                 .y1(d => y(d[1]));

  const layers = g.selectAll(".layer")
    .data(stackedData)
    .join("path")
      .attr("class", "layer")
      .attr("d", area)
      .attr("fill", d => color(d.key))
      .on("mouseover", function(event, d) {
        layers.attr("opacity", 0.2);
        d3.select(this).attr("opacity", 1).raise();
        tooltip.style("opacity", 1);
      })
      .on("mousemove", function(event, d) {
        const xm = d3.pointer(event, this)[0];
        const year = Math.round(x.invert(xm));
        const row = stackedData[0].map(r => r.data).find(r => r.Year === year);
        if (row && row[d.key] !== undefined) {
          tooltip.style("left", (event.pageX + 10) + "px")
                 .style("top", (event.pageY - 25) + "px")
                 .html(`<strong>${d.key}</strong><br>Year: ${year}<br>Population: ${row[d.key].toLocaleString()}`);
        }
      })
      .on("mouseout", function() {
        layers.attr("opacity", 1);
        tooltip.style("opacity", 0);
      });

  xAxisG.call(d3.axisBottom(x).tickFormat(d3.format("d")));
  yAxisG.call(d3.axisLeft(y).tickFormat(d3.format(".2s")));

  // Legend
  const legend = g.append("g").attr("transform", `translate(${width + 20},0)`);
  continents.forEach((c, i) => {
    const gL = legend.append("g").attr("transform", `translate(0,${i*20})`);
    gL.append("rect").attr("width", 15).attr("height", 15).attr("fill", color(c));
    gL.append("text").attr("x", 20).attr("y", 12).text(c);
  });
});
</script>
</body>
</html>
